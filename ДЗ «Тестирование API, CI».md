# Домашнее задание к занятию «1.2. Тестирование API, CI»

В качестве результата пришлите ссылку на ваш GitHub-проект в личном кабинете студента на сайте [netology.ru](https://netology.ru).

Первые две задачи этого занятия нужно делать в одном репозитории.

**Важно**: если у вас что-то не получилось, то оформляйте Issue [по установленным правилам](../report-requirements.md).

**Важно**: не делайте ДЗ всех занятий в одном репозитории! Иначе вам потом придётся достаточно сложно подключать системы Continuous Integration.

## Как сдавать задачи

1. Инициализируйте на своём компьютере пустой Git-репозиторий
1. Добавьте в него готовый файл [.gitignore](../.gitignore)
1. Добавьте в этот же каталог код вашего приложения
1. Сделайте необходимые коммиты
1. Создайте публичный репозиторий на GitHub и свяжите свой локальный репозиторий с удалённым
1. Сделайте пуш (удостоверьтесь, что ваш код появился на GitHub)
1. Ссылку на ваш проект отправьте в личном кабинете на сайте [netology.ru](https://netology.ru)
1. Задачи, отмеченные, как необязательные, можно не сдавать, это не повлияет на получение зачета

В качестве примера можете посмотреть на этот проект (ваш по структуре должен выглядеть так же): https://github.com/netology-code-samples/aqa-ci-demo

## Информация по учебным JAR

Важно: если вы работаете на Windows с Турецкой локалью и при запуске учебных приложений получаете Exception вида:
```
Caused by: java.lang.NoSuchFieldException: wrıteHandlerReference (тут не английская i, а именно ı или ?)
  at java.lang.Class.getDeclaredField(Unknown Source)
  at java.util.concurrent.atomic.AtomicReferenceFieldUpdater$AtomicReferenceFieldUpdaterImpl$1.run(Unknown Source)
  at java.util.concurrent.atomic.AtomicReferenceFieldUpdater$AtomicReferenceFieldUpdaterImpl$1.run(Unknown Source)
  at java.security.AccessController.doPrivileged(Native Method)
  ... 21 more
```

Тогда вам все JAR'ники нужно будет запускать командой:
```
java -Duser.language=en -Duser.country=US -jar app-mbank.jar
```

Часть `-jar app-mbank.jar` может меняться, но первая часть для вас во всех ДЗ (при запуске на вашем ПК будет именно такой).

## Задача №3 - Postman Echo

**Важно**: эту задачу нужно выполнять в отдельном репозитории

В этой задаче мы сэмулируем ситуацию, в которой SUT уже запущен, а мы из теста просто обращаемся к нему.

Есть специальный сервис, предназначенный для тестирования HTTP-запросов. Называется он [Postman Echo](https://docs.postman-echo.com) (никогда не тестируйте автоматизированными средствами веб-сервисы, если у вас нет на этого письменного разрешения либо веб-сервисы специально не предназначены для этого).

Мы можем отправлять туда запросы и получать ответы.

С GET-запросами мы немного потренировались, теперь нас будут интересовать POST-запросы, а именно отправка тела запроса:

```java
// Given - When - Then
// Предусловия
given()
  .baseUri("https://postman-echo.com")
  .body("some data") // отправляемые данные (заголовки и query можно выставлять аналогично)
// Выполняемые действия
.when()
  .post("/post")
// Проверки
.then()
  .statusCode(200)
  .body(/* --> ваша проверка здесь <-- */)
;
```

Что нужно сделать:
1. Создайте новый проект на базе Gradle
2. Добавьте необходимые зависимости (если вы не пишите схему, то только rest-assured)
3. Напишите тест, взяв сам запрос из кода выше
4. Изучите ответ и напишите JsonPath-выражение вместо строк `/* --> ваша проверка здесь <--*/`, которое проверит, что в нужном поле хранятся отправленные вами данные (обратите внимание, теперь у вас не массив, а объект).

Можете воспользоваться сервисом https://rapathevaluate.herokuapp.com для быстрой проверки своих JsonPath-выражений.

Удостоверьтесь, что если вы будете использовать неверное выражение, то тесты упадут (в том числе и в CI).

Обратите внимание: если вам приходит вот такой объект:
```json
{
    "data": "some value"
}
```

То обратиться к нему с помощью JsonPath можно вот так: `data`, например: `.body("data", equalTo("some value"))`. Т.е. обращение к полю верхнеуровневого объекта (он называется безымянный) идёт без точки (в примере на лекциях у нас был массив и мы сразу обращались `[0]` - то же самое).

Если соберётесь отправлять текст не на латинице, то вам нужно будет выставлять кодировку (например, UTF-8):
```java
given()
  .baseUri("https://postman-echo.com")
  .contentType("text/plain; charset=UTF-8")
  .body("some data")
.when()
  .post("/post")
.then()
  .statusCode(200)
  .body(/* --> ваша проверка здесь <-- */)
;
```

Пришлите на проверку ссылку на ваш репозиторий (удостоверьтесь, что в истории сборки были как Success, так и Fail, иначе будет не видно, как вы проверяли, что сборка падает в CI).
